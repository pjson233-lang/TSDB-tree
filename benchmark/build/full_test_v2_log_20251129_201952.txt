=========================================
完整性能测试 v2（并行 Merge 版本）
测试时间: Sat Nov 29 20:19:52 CST 2025
重点关注: 数据完整性（alloc_failures, Tree records）
=========================================

【Insert-Only 性能测试（1-32线程）】
=========================================

--- 1 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 1
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15017
  threads         : 1
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
Insert Finished!
  Total inserted records : 10240000
  Total time             : 183.798 ms
  Real Throughput        : 55.7133 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 56.7823 Mops/sec (median thread time, write peak)
  Per-thread time range  : [180.338 ms, 180.338 ms]
  Memory Usage           : 562.565 MB
  Buffered records       : 6149835
  Tree records           : 4075632
  Alloc failures         : 0
  Buffer Waste Ratio     : 50.0787 %
  Slot Fill Ratio        : 99.9928 %
  Merge iterations       : 2
  Merge total time       : 163.542 ms
  Merge CPU Ratio        : 88.9792 %
  Tree records (post-flush) : 4075632

===== TSDB Unified Benchmark Done =====

--- 2 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 2
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15019
  threads         : 2
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
Insert Finished!
  Total inserted records : 10240000
  Total time             : 132.073 ms
  Real Throughput        : 77.5329 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 167.83 Mops/sec (median thread time, write peak)
  Per-thread time range  : [60.879 ms, 61.014 ms]
  Memory Usage           : 545.145 MB
  Buffered records       : 6924116
  Tree records           : 3311792
  Alloc failures         : 0
  Buffer Waste Ratio     : 50.0344 %
  Slot Fill Ratio        : 99.977 %
  Merge iterations       : 1
  Merge total time       : 111.851 ms
  Merge CPU Ratio        : 84.6888 %
  Tree records (post-flush) : 3311792

===== TSDB Unified Benchmark Done =====

--- 4 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 4
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15023
  threads         : 4
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
Insert Finished!
  Total inserted records : 10240000
  Total time             : 282.057 ms
  Real Throughput        : 36.3047 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 336.986 Mops/sec (median thread time, write peak)
  Per-thread time range  : [30.329 ms, 30.402 ms]
  Memory Usage           : 625.067 MB
  Buffered records       : 3441824
  Tree records           : 6798176
  Alloc failures         : 0
  Buffer Waste Ratio     : 50.0277 %
  Slot Fill Ratio        : 99.9339 %
  Merge iterations       : 1
  Merge total time       : 261.838 ms
  Merge CPU Ratio        : 92.8316 %
  Tree records (post-flush) : 6798176

===== TSDB Unified Benchmark Done =====

--- 8 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 8
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15031
  threads         : 8
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
Insert Finished!
  Total inserted records : 10240000
  Total time             : 245.056 ms
  Real Throughput        : 41.7864 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 352.593 Mops/sec (median thread time, write peak)
  Per-thread time range  : [28.883 ms, 29.258 ms]
  Memory Usage           : 626.144 MB
  Buffered records       : 3405678
  Tree records           : 6834322
  Alloc failures         : 0
  Buffer Waste Ratio     : 50.0543 %
  Slot Fill Ratio        : 99.8333 %
  Merge iterations       : 1
  Merge total time       : 224.525 ms
  Merge CPU Ratio        : 91.6219 %
  Tree records (post-flush) : 6834322

===== TSDB Unified Benchmark Done =====

--- 16 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 16
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15047
  threads         : 16
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
  [WARNING] Alloc failures = 29915 - data may be lost!
Insert Finished!
  Total inserted records : 10240000
  Total time             : 472.16 ms
  Real Throughput        : 21.6876 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 591.395 Mops/sec (median thread time, write peak)
  Per-thread time range  : [15.141 ms, 19.045 ms]
  Memory Usage           : 704.193 MB
  Buffered records       : 2548
  Tree records           : 10222498
  Alloc failures         : 29915
  Buffer Waste Ratio     : 50.1803 %
  Slot Fill Ratio        : 41.5119 %
  Merge iterations       : 1
  Merge total time       : 451.858 ms
  Merge CPU Ratio        : 95.7002 %
  Tree records (post-flush) : 10225046

===== TSDB Unified Benchmark Done =====

--- 32 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 32
Flip interval      : 20 ms

=== INSERT-ONLY workload ===
  series          : 1024
  total records   : 10240000
  slots/buffer    : 15079
  threads         : 32
  flip interval   : 20 ms
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
  [WARNING] Alloc failures = 3183 - data may be lost!
Insert Finished!
  Total inserted records : 10240000
  Total time             : 421.119 ms
  Real Throughput        : 24.3162 Mops/sec (wall time, includes merge)
  Writer-only Throughput : 844.118 Mops/sec (median thread time, write peak)
  Per-thread time range  : [0 ms, 21.442 ms]
  Memory Usage           : 703.71 MB
  Buffered records       : 80705
  Tree records           : 10157708
  Alloc failures         : 3183
  Buffer Waste Ratio     : 50.221 %
  Slot Fill Ratio        : 85.1337 %
  Merge iterations       : 1
  Merge total time       : 399.559 ms
  Merge CPU Ratio        : 94.8803 %
  Tree records (post-flush) : 10162066

===== TSDB Unified Benchmark Done =====

【Lookup-Only 性能测试（1-32线程）】
=========================================

--- 1 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 1
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 46.154 ms
  Throughput             : 22.1866 Mops/sec

===== TSDB Unified Benchmark Done =====

--- 2 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 2
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 54.893 ms
  Throughput             : 18.6545 Mops/sec

===== TSDB Unified Benchmark Done =====

--- 4 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 4
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 58.708 ms
  Throughput             : 17.4423 Mops/sec

===== TSDB Unified Benchmark Done =====

--- 8 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 8
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 44.107 ms
  Throughput             : 23.2163 Mops/sec

===== TSDB Unified Benchmark Done =====

--- 16 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 16
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 26.109 ms
  Throughput             : 39.2202 Mops/sec

===== TSDB Unified Benchmark Done =====

--- 32 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 32
Flip interval      : 20 ms

=== LOOKUP-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[ERROR] Tree is empty after build! Lookup test will fail.
Lookup Finished!
  Total lookups issued   : 1024000
  Total hits             : 0
  Hit rate               : 0 %
  Total time             : 27.402 ms
  Throughput             : 37.3695 Mops/sec

===== TSDB Unified Benchmark Done =====

【Scan-Only 性能测试（1-32线程）】
=========================================

--- 1 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 1
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 1.045 ms
  Throughput             : 4899.52 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

--- 2 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 2
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 1.593 ms
  Throughput             : 3214.06 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

--- 4 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 4
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 1.493 ms
  Throughput             : 3429.34 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

--- 8 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 8
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 2.291 ms
  Throughput             : 2234.83 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

--- 16 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 16
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 1.727 ms
  Throughput             : 2964.68 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

--- 32 线程 ---
===== TSDB Unified Benchmark =====
Total records      : 10240000
Records per sensor : 10000
Sensors            : 1024
Threads            : 32
Flip interval      : 20 ms

=== SCAN-ONLY workload ===
[Generator] target records = 10240000
[Generator] series = 1024, per_series_cap ≈ 10000
[Generator] actually generated = 10240000 points.
[BuildIndex] Building index...
[BuildIndex] Done. Tree records: 0

[Scan] Building scan queries...
[ScanQuery] Generated 5120 scan queries (each should return 10-100 records)
[Scan] Generated 5120 scan queries.

Scan Finished!
  Total scan ops         : 5120
  Total returned records : 0
  Avg records per scan   : 0
  Total time             : 1.849 ms
  Throughput             : 2769.06 Kops/sec (scan operations)

===== TSDB Unified Benchmark Done =====

=========================================
测试完成时间: Sat Nov 29 20:19:58 CST 2025
日志文件: /home/www/sbtree1/benchmark/build/full_test_v2_log_20251129_201952.txt
=========================================
